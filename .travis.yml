language: python
dist: bionic
python:
- '3.6'
- '3.7.13'
- '3.8.13'
- '3.9'
- '3.10.0'
- '3.10.1'
install:
- pip install -U -r requirements.txt
- pip install -U -r test_requirements.txt
- pip install --no-deps -e .
script:
- pytest --cov=src/ --cov-report term-missing --cov-report term:skip-covered --cov-config=tox.ini
  --cov-fail-under=100 -s -r .
- flake8 src
- derp src src/citrine/__version__.py
- cd docs; make html; cd ..;
- touch ./docs/_build/html/.nojekyll
# only run the validate-version-bump.sh script on PR builds against master, since those have access to a "master" reference to git show the version
# following https://docs.travis-ci.com/user/environment-variables/#convenience-variables
# the pull request isn't set to true if its a PR; its just set to false if its not.
- if [ "$TRAVIS_PULL_REQUEST" != "false" ] && [ "$TRAVIS_BRANCH" == "main" ]; then
  bash ./scripts/validate-version-bump.sh; fi
deploy:
- provider: pages
  skip_cleanup: true
  github_token: "$GH_SECRET_TOKEN"
  keep_history: true
  local_dir: "./docs/_build/html/"
  on:
    tags: true
    python: '3.6' # only need this to run once
- provider: pypi
  user: CitrineInformatics
  password: "$PYPI_PASSWORD"
  distributions: sdist bdist_wheel
  skip_existing: true
  on:
    tags: true
