
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>2.3.6. Design workflows &#8212; Citrine Python 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. FAQ" href="../FAQ/index.html" />
    <link rel="prev" title="2.3.5. Scores" href="scores.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="design-workflows">
<h1>2.3.6. Design workflows<a class="headerlink" href="#design-workflows" title="Permalink to this headline">¶</a></h1>
<p>A design workflow ranks materials according to a <a class="reference internal" href="scores.html"><span class="doc">score</span></a>.
This workflow is comprised of three modules:</p>
<ul class="simple">
<li><p><a class="reference internal" href="design_spaces.html"><span class="doc">Design space</span></a> defines all possible materials that can be generated.</p></li>
<li><p><a class="reference internal" href="predictors.html"><span class="doc">Predictor</span></a> adds information to a material using predictions from a machine-learned model.</p></li>
<li><p><a class="reference internal" href="processors.html"><span class="doc">Processor</span></a> defines how to pick the “next” material.</p></li>
</ul>
<div class="section" id="registration-and-validation">
<h2>2.3.6.1. Registration and validation<a class="headerlink" href="#registration-and-validation" title="Permalink to this headline">¶</a></h2>
<p>A workflow is registered with a project and validated before it is ready for use.
Once registered, validation occurs automatically.
Validation status can be one of the following states:</p>
<ul class="simple">
<li><p><strong>Created:</strong> The module has been registered with a project and has been queued for validation.</p></li>
<li><p><strong>Validating:</strong> The workflow is currently validating. The status will be updated to one of the subsequent states upon completion.</p></li>
<li><p><strong>Invalid:</strong> Validation completed successfully but found errors with the workflow.</p></li>
<li><p><strong>Ready:</strong> Validation completed successfully and found no errors.</p></li>
<li><p><strong>Error:</strong> Validation did not complete.
An error was raised during the validation process that prevented an invalid or ready status to be determined.
Validation of a workflow and all constituent modules must complete with ready status before the workflow can be executed.</p></li>
</ul>
<p>The following example demonstrates how to use the python SDK to register a workflow (assuming a design space, predictor and processor were registered previously), wait for validation to complete and check the final status:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">citrine</span> <span class="kn">import</span> <span class="n">Citrine</span>
<span class="kn">from</span> <span class="nn">citrine.informatics.workflows</span> <span class="kn">import</span> <span class="n">DesignWorkflow</span>

<span class="c1"># create a session with citrine using API variables</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Citrine</span><span class="p">(</span><span class="n">API_KEY</span><span class="p">,</span> <span class="n">API_SCHEME</span><span class="p">,</span> <span class="n">API_HOST</span><span class="p">,</span> <span class="n">API_PORT</span><span class="p">)</span>

<span class="n">project</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">projects</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;Example project&#39;</span><span class="p">)</span>

<span class="c1"># create a workflow using existing modules and register it with the project</span>
<span class="n">workflow</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
    <span class="n">DesignWorkflow</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Example workflow&#39;</span><span class="p">,</span>
        <span class="n">predictor_id</span><span class="o">=</span><span class="n">predictor</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
        <span class="n">processor_id</span><span class="o">=</span><span class="n">processor</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
        <span class="n">design_space_id</span><span class="o">=</span><span class="n">design_space</span><span class="o">.</span><span class="n">uid</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># wait until the workflow is no longer validating</span>
<span class="c1"># we must get the workflow every time we wish to fetch the latest status</span>
<span class="k">while</span> <span class="n">project</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;VALIDATING&quot;</span><span class="p">:</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># print final validation status</span>
<span class="n">validated_workflow</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">validated_workflow</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
<span class="c1"># status info will contain relevant validation information</span>
<span class="c1"># (i.e. why the workflow is valid/invalid)</span>
<span class="k">print</span><span class="p">(</span><span class="n">validated_workflow</span><span class="o">.</span><span class="n">status_info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="execution-and-results">
<h2>2.3.6.2. Execution and results<a class="headerlink" href="#execution-and-results" title="Permalink to this headline">¶</a></h2>
<p>When a design workflow is executed, the processor will search the design space for optimal materials using additional information provided by the predictor.
The result is a list of scored and ranked materials.
Materials at the head of the list are the best materials found from searching the design space.</p>
<p>A workflow can be run using the python SDK.
Triggering a workflow returns a workflow execution object.
A workflow execution has a status (in progress, succeeded, or failed) and results (once execution has succeeded).
Results of a successful workflow are returned as a dictionary.
The <code class="docutils literal notranslate"><span class="pre">results</span></code> key maps to a nested list of <code class="docutils literal notranslate"><span class="pre">candidates</span></code> and <code class="docutils literal notranslate"><span class="pre">scores</span></code>.
The <a href="#id1"><span class="problematic" id="id2">``</span></a>i``th candidate corresponds to the <a href="#id3"><span class="problematic" id="id4">``</span></a>i``th score.</p>
<p>Each candidate and score is a dictionary.
The former contains descriptor key-value pairs and uncertainty in descriptor values.
The latter contains a key-value pair for each score.
For example, if input materials contain an input <code class="docutils literal notranslate"><span class="pre">x</span></code> and are scored by using MLI for predicted output <code class="docutils literal notranslate"><span class="pre">z</span></code> the execution results would have the form:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;uncertainty_in_x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;uncertainty_in_x&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span>
            <span class="c1"># ...</span>
        <span class="p">]],</span>
        <span class="p">[</span><span class="s2">&quot;scores&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;mli_z&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">},</span>
            <span class="c1"># ...</span>
        <span class="p">]]</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The length of <code class="docutils literal notranslate"><span class="pre">candidates</span></code> will always equal that of <code class="docutils literal notranslate"><span class="pre">scores</span></code>.
A maximum of 200 candidates and scores can be returned by an execution.
If the design space contains more than 200 possible materials, only the top 200 will be returned by an execution.
Note, the multiple layers of lists in the results.
The <code class="docutils literal notranslate"><span class="pre">results</span></code> key maps to a list. This list contains 2 items.
Each item is a list of the form <code class="docutils literal notranslate"><span class="pre">[name,</span> <span class="pre">[values]]</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">[&quot;candidates&quot;,</span> <span class="pre">list_of_candidates]</span></code>.</p>
<p>The following demonstrates how to trigger workflow execution, wait for the design run to complete and inspect the best material found by the workflow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">citrine.informatics.objectives</span> <span class="kn">import</span> <span class="n">ScalarMaxObjective</span>
<span class="kn">from</span> <span class="nn">citrine.informatics.scores</span> <span class="kn">import</span> <span class="n">MLIScore</span>

<span class="c1"># create a score with the desired objectives and baselines</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">MLIScore</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Example score&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Used to rank materials&#39;</span><span class="p">,</span>
    <span class="c1"># create an objective to maximize shear modulus</span>
    <span class="c1"># the descriptor key must match a descriptor in materials produced from teh design space</span>
    <span class="n">objectives</span><span class="o">=</span><span class="p">[</span><span class="n">ScalarMaxObjective</span><span class="p">(</span><span class="n">descriptor_key</span><span class="o">=</span><span class="s1">&#39;Shear modulus&#39;</span><span class="p">)],</span>
    <span class="n">baselines</span><span class="o">=</span><span class="p">[</span><span class="mf">150.0</span><span class="p">]</span> <span class="c1"># one for each objective</span>
<span class="p">)</span>

<span class="c1"># trigger a design run using a previously registered and validated workflow</span>
<span class="n">execution</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">executions</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

<span class="c1"># wait for execution to complete</span>
<span class="k">while</span> <span class="n">execution</span><span class="o">.</span><span class="n">status</span><span class="p">()</span><span class="o">.</span><span class="n">in_progress</span><span class="p">:</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># retrieve the results</span>
<span class="n">execution_results</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="n">results</span><span class="p">()</span>
<span class="c1"># extract the candidates and the scores</span>
<span class="n">candidates</span> <span class="o">=</span> <span class="n">execution_results</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">execution_results</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># pull out the candidate with the highest shear modulus and its score</span>
<span class="c1"># (this should be the candidate at the head of the list since we used shear modulus to score and rank materials)</span>
<span class="n">best_candidate</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">best_candidate</span><span class="p">)</span>
<span class="n">best_score</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">best_score</span><span class="p">)</span>

<span class="c1"># we can confirm the best candidate is at the head of the list using</span>
<span class="c1"># this candidate will be the same as best_candidate above</span>
<span class="n">candidate_with_max_shear_modulus</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">candidate</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">candidate</span><span class="p">[</span><span class="s1">&#39;Shear modulus&#39;</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="n">candidate_with_max_shear_modulus</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=CitrineInformatics&repo=citrine-python&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">1. Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/basic_structure.html">1.1. Structure of the Citrine Python Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/basic_functionality.html">1.2. Using the Citrine Python Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/data_model.html">1.3. Data Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/public_access.html">1.4. Dataset Access Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/working_with_files.html">1.5. Working With Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/code_examples.html">1.6. Code Examples</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">2. Workflows</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#modules">2.1. Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#design-workflows">2.2. Design workflows</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#table-of-contents">2.3. Table of Contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ/index.html">3. FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../FAQ/prohibited_data_patterns.html">3.1. Prohibited Data Patterns</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">2. Workflows</a><ul>
      <li>Previous: <a href="scores.html" title="previous chapter">2.3.5. Scores</a></li>
      <li>Next: <a href="../FAQ/index.html" title="next chapter">3. FAQ</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Citrine Informatics.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/workflows/design_workflows.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>