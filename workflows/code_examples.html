<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.11. AI Engine Code Examples &mdash; Citrine Python 2.11.2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Formulations Example" href="../formulations_example.html" />
    <link rel="prev" title="4.10. Predictor Evaluation Workflows" href="predictor_evaluation_workflows.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.11.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">1. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_entry.html">2. GEMD Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_extraction.html">3. Data Extraction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">4. AI Engine</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">4.1. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="descriptors.html">4.2. Descriptors</a></li>
<li class="toctree-l2"><a class="reference internal" href="descriptors.html#platform-vocabularies">4.3. Platform Vocabularies</a></li>
<li class="toctree-l2"><a class="reference internal" href="predictors.html">4.4. Predictors</a></li>
<li class="toctree-l2"><a class="reference internal" href="design_spaces.html">4.5. Design Spaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="design_workflows.html">4.6. Design Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="scores.html">4.7. Scores</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_sources.html">4.8. Data Sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="predictor_reports.html">4.9. Predictor Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="predictor_evaluation_workflows.html">4.10. Predictor Evaluation Workflows</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.11. AI Engine Code Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-preprocessing-and-postprocessing-in-a-graphpredictor">4.11.1. Example: preprocessing and postprocessing in a GraphPredictor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../formulations_example.html">5. Formulations Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../molecular_generation.html">6. [ALPHA] Generative Design Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ/index.html">7. FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Citrine Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">4. </span>AI Engine</a> &raquo;</li>
      <li><span class="section-number">4.11. </span>AI Engine Code Examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/workflows/code_examples.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ai-engine-code-examples">
<h1><span class="section-number">4.11. </span>AI Engine Code Examples<a class="headerlink" href="#ai-engine-code-examples" title="Permalink to this headline"></a></h1>
<section id="example-preprocessing-and-postprocessing-in-a-graphpredictor">
<span id="graph-predictor-example"></span><h2><span class="section-number">4.11.1. </span>Example: preprocessing and postprocessing in a GraphPredictor<a class="headerlink" href="#example-preprocessing-and-postprocessing-in-a-graphpredictor" title="Permalink to this headline"></a></h2>
<p>Within a <a class="reference internal" href="../reference/citrine.informatics.predictors.graph_predictor.html#citrine.informatics.predictors.graph_predictor.GraphPredictor" title="citrine.informatics.predictors.graph_predictor.GraphPredictor"><code class="xref py py-class docutils literal notranslate"><span class="pre">GraphPredictor</span></code></a>, one can use <a class="reference internal" href="../reference/citrine.informatics.predictors.expression_predictor.html#citrine.informatics.predictors.expression_predictor.ExpressionPredictor" title="citrine.informatics.predictors.expression_predictor.ExpressionPredictor"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExpressionPredictor</span></code></a> modules to preprocess data before performing machine learning with a <a class="reference internal" href="../reference/citrine.informatics.predictors.auto_ml_predictor.html#citrine.informatics.predictors.auto_ml_predictor.AutoMLPredictor" title="citrine.informatics.predictors.auto_ml_predictor.AutoMLPredictor"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoMLPredictor</span></code></a>, and to post-process the AutoMLPredictor’s output.
This is a very common and powerful use case for graphical modeling.
Here we show an example of how to combine these modules to accomplish those many suitable tasks.</p>
<p>Using ExpressionPredictors to perform pre-processing can be used to featurize data, which is a valuable way to leverage domain knowledge by transforming raw inputs into quantities known to be relevant.
In the example below, we use an ExpressionPredictor to annotate the training data with a “hydration ratio”.
The hydration ratio is the mass ratio of water to flour.
Bakers know this quantity to be of fundamental importance to the taste and texture of bread, so computing this quantity might be expected to help the AutoMLPredictor make more efficient use of scarce training data.
(In a more standard materials science context, an ExpressionPredictor might be used to annotate semiconductor data with an analytical expression of idealized electron mobility as a function of dopant concentrations.)</p>
<p>In the example below, we use the ExpressionPredictor feature to compute a bread loaf product’s shelf life as a figure of merit.
This simulates a scenario where shelf life is determined by a deterministic quality control rule that depends on a few physically measurable quantities: <code class="docutils literal notranslate"><span class="pre">final</span> <span class="pre">pH</span></code> and <code class="docutils literal notranslate"><span class="pre">final</span> <span class="pre">hydration</span></code> as estimated by the AutoMLPredictor, as well as the fraction of salt in the ingredients.
Using ExpressionPredictors in this manner to post-process learned data is often useful for displaying information on the platform based on transformations of the learned physical properties.
This pattern is also extremely useful for performing optimization over complex objectives: in the following example, we can use shelf life as an objective or constraint in a <a class="reference internal" href="design_workflows.html"><span class="doc">DesignWorkflow</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">citrine.informatics.descriptors</span> <span class="kn">import</span> <span class="n">RealDescriptor</span>
<span class="kn">from</span> <span class="nn">citrine.informatics.predictors</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ExpressionPredictor</span><span class="p">,</span>
    <span class="n">GraphPredictor</span><span class="p">,</span>
    <span class="n">AutoMLPredictor</span>
<span class="p">)</span>

<span class="c1">######## Omitted step: create DataSource with columns associated with the following descriptors ########</span>
<span class="c1"># wheat_flour_quantity = RealDescriptor(</span>
<span class="c1">#     &#39;wheat flour mass&#39;, lower_bound=300, upper_bound=550, units=&quot;g&quot;)</span>
<span class="c1"># rye_flour_quantity = RealDescriptor(</span>
<span class="c1">#     &#39;rye flour mass&#39;, lower_bound=0, upper_bound=100, units=&quot;g&quot;)</span>
<span class="c1"># water_quantity = RealDescriptor(</span>
<span class="c1">#    &#39;water mass&#39;, lower_bound=200, upper_bound=400, units=&quot;g&quot;)</span>
<span class="c1"># salt_quantity = RealDescriptor(</span>
<span class="c1">#    &#39;salt mass&#39;, lower_bound=4, upper_bound=8, units=&quot;g&quot;)</span>
<span class="c1"># starter_quantity = RealDescriptor(</span>
<span class="c1">#    &#39;starter mass&#39;, lower_bound=5, upper_bound=30, units=&quot;g&quot;)</span>
<span class="c1"># final_ph = RealDescriptor(</span>
<span class="c1">#    &#39;final pH&#39;, lower_bound=2.5, upper_bound=5, units=&quot;&quot;)</span>
<span class="c1"># final_loaf_hydration = RealDescriptor(</span>
<span class="c1">#    &#39;final loaf hydration&#39;, lower_bound=0, upper_bound=100, units=&quot;&quot;)</span>
<span class="c1">#</span>
<span class="c1"># data_source = create_ara_data_source_from_breads_gemd(</span>
<span class="c1">#    descriptors=[...descriptors above...])</span>

<span class="n">dough_hydration</span> <span class="o">=</span> <span class="n">RealDescriptor</span><span class="p">(</span>
    <span class="n">key</span><span class="o">=</span><span class="s1">&#39;dough hydration&#39;</span><span class="p">,</span> <span class="n">lower_bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_bound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">shelf_life</span> <span class="o">=</span> <span class="n">RealDescriptor</span><span class="p">(</span>
    <span class="n">key</span><span class="o">=</span><span class="s1">&#39;approximate shelf life&#39;</span><span class="p">,</span> <span class="n">lower_bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_bound</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">)</span>

<span class="n">dough_hydration_calculator</span> <span class="o">=</span> <span class="n">ExpressionPredictor</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dough hydration calculator&#39;</span><span class="p">,</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="s1">&#39;(water + 0.5*starter) / (wheat + rye + 0.5*starter)&#39;</span><span class="p">,</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">dough_hydration</span><span class="p">,</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;wheat&#39;</span><span class="p">:</span> <span class="n">wheat_flour_quantity</span><span class="p">,</span>
        <span class="s1">&#39;rye&#39;</span><span class="p">:</span> <span class="n">rye_flour_quantity</span><span class="p">,</span>
        <span class="s1">&#39;water&#39;</span><span class="p">:</span> <span class="n">water_quantity</span><span class="p">,</span>
        <span class="s1">&#39;starter&#39;</span><span class="p">:</span> <span class="n">starter_quantity</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">physical_properties_predictor</span> <span class="o">=</span> <span class="n">AutoMLModel</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;physical properties model&#39;</span><span class="p">,</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">wheat_flour_quantity</span><span class="p">,</span>
        <span class="n">rye_flour_quantity</span><span class="p">,</span>
        <span class="n">water_quantity</span><span class="p">,</span>
        <span class="n">salt_quantity</span><span class="p">,</span>
        <span class="n">starter_quantity</span><span class="p">,</span>
        <span class="n">dough_hydration</span>
    <span class="p">],</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">final_ph</span><span class="p">,</span>
        <span class="n">final_loaf_hydration</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">training_data</span><span class="o">=</span><span class="p">[</span><span class="n">training_table</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">shelf_life_calculator</span> <span class="o">=</span> <span class="n">ExpressionPredictor</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;shelf life estimator&#39;</span><span class="p">,</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="s1">&#39;4*exp(-0.1*pH - 1.3*w^2 + 5*(water+0.5*starter)/(wheat+rye+water+starter))&#39;</span><span class="p">,</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">shelf_life</span><span class="p">,</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;pH&#39;</span><span class="p">:</span> <span class="n">final_ph</span><span class="p">,</span>
        <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">final_loaf_hydration</span><span class="p">,</span>
        <span class="s1">&#39;wheat&#39;</span><span class="p">:</span> <span class="n">wheat_flour_quantity</span><span class="p">,</span>
        <span class="s1">&#39;rye&#39;</span><span class="p">:</span> <span class="n">rye_flour_quantity</span><span class="p">,</span>
        <span class="s1">&#39;water&#39;</span><span class="p">:</span> <span class="n">water_quantity</span><span class="p">,</span>
        <span class="s1">&#39;starter&#39;</span><span class="p">:</span> <span class="n">starter_quantity</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">graph_predictor</span> <span class="o">=</span> <span class="n">GraphPredictor</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;bread shelf life predictor&#39;</span><span class="p">,</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Uses bread ingredients to estimate shelf life, given a fixed manufacturing process&#39;</span><span class="p">,</span>
    <span class="n">predictors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">dough_hydration_calculator</span><span class="p">,</span>
        <span class="n">physical_properties_predictor</span><span class="p">,</span>
        <span class="n">shelf_life_calculator</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This example is visualized below.
Nodes with dashed outlines represent degrees of freedom in the recipe, and those with solid outlines represent predictors.
Nodes with dotted outlines represent predicted quantities; note that only <code class="docutils literal notranslate"><span class="pre">final</span> <span class="pre">pH</span></code> and <code class="docutils literal notranslate"><span class="pre">final</span> <span class="pre">loaf</span> <span class="pre">hydration</span></code> are the only predicted quantities that exist in the training data.</p>
<p><a class="reference internal" href="../_images/bread_predictor_graph_viz.jpg"><img alt="Visualization of graph predictor." src="../_images/bread_predictor_graph_viz.jpg" style="width: 800px;" /></a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="predictor_evaluation_workflows.html" class="btn btn-neutral float-left" title="4.10. Predictor Evaluation Workflows" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../formulations_example.html" class="btn btn-neutral float-right" title="5. Formulations Example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Citrine Informatics.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>